import React, { createContext, useContext, useState, ReactNode } from 'react';

export type Language = 'en' | 'zh';

export const translations = {
  en: {
    appTitle: 'Curio',
    appSubtitle: 'Museum',
    heroTitle: 'Curio Museum',
    heroSubtitle: 'Where physical memories become eternal archives.',
    featuredArtifact: 'Featured Artifact',
    artifacts: 'Artifacts',
    archives: 'Archives',
    avgQuality: 'Avg Quality',
    searchPlaceholder: 'Search your vast archives...',
    newArchive: 'New Archive',
    expandSpace: 'Expand the curated space',
    exploreSample: 'Explore Sample',
    navHome: 'Home',
    ctaAddFirst: 'Add your first item',
    ctaPromise: 'Guided capture in under 5 minutes. Keep progress even if AI is slow.',
    catalogFirst: 'Catalog First Item',
    enterExhibition: 'Enter Exhibition',
    vocalGuide: 'Vocal Guide',
    galleryAwaits: 'The gallery awaits.',
    museumDefinition: 'A museum is defined by what it protects. Begin your archival journey today.',
    restoringArchives: 'Restoring the archives...',
    addItem: 'Add Item',
    profile: 'Profile',
    add: 'Add',
    exhibitNo: 'Exhibit No. {n} of {total}',
    updatePhoto: 'Update Artifact Photo',
    exportCard: 'Export Card',
    archiveNarrative: 'Archive Narrative',
    technicalSpec: 'Technical Spec',
    provenancePlaceholder: 'Begin the provenance of this artifact...',
    registryQuality: 'Registry Quality Score',
    deleteConfirm: 'Permanently remove this item from the collection?',
    analyzingPhoto: 'Analyzing photo...',
    geminiExtracting: 'Gemini is extracting details for your collection.',
    stepProgress: 'Step {current} of {total}',
    stepChooseCollection: 'Choose collection',
    stepChooseCollectionDesc: 'Pick where this artifact will live.',
    stepCapture: 'Add photo',
    stepCaptureDesc: 'Upload or snap the item image.',
    stepAnalyze: 'AI assist',
    stepAnalyzeDesc: 'We attempt to extract details for you.',
    stepVerify: 'Verify details',
    stepVerifyDesc: 'Check and fill any missing fields.',
    takePhoto: 'Take Photo',
    uploadPhoto: 'Upload Photo',
    changePhoto: 'Change Photo',
    skipManual: 'Skip and add manually',
    enterManually: 'Enter manually',
    aiUnavailableManual: 'AI analysis is unavailable. Please fill in the details manually.',
    analysisFallback: 'Analysis failed. Continue with manual entry.',
    addToCollection: 'Add to Collection',
    rating: 'Rating',
    title: 'Title',
    notes: 'Notes',
    anyRating: 'Any Rating',
    filterCollection: 'Filter Collection',
    clear: 'Clear',
    clearFilter: 'Remove filter',
    clearAll: 'Clear all',
    activeFilters: 'Active filters',
    apply: 'Apply',
    cancel: 'Cancel',
    createCollection: 'Create Collection',
    dataPresets: 'Data Presets',
    presetDesc: 'Determines which fields (e.g. Artist, Year) are available.',
    templatePreview: 'Template preview',
    templateFields: 'Fields included',
    icon: 'Icon',
    name: 'Name',
    guideTitle: 'Museum Guide',
    guideConnecting: 'Preparing the archive expert...',
    guideActive: 'You can talk to the guide about your collection.',
    guideError: 'Something went wrong. Please check your microphone.',
    tryAgain: 'Try Again',
    noPhoto: 'No Photo',
    loadError: 'Load Error',
    readOnlyMode: 'Read-only',
    readOnlyCollectionDesc: 'Public sample collections can be viewed but not edited.',
    readOnlyItemDesc: 'Sign in as an admin or owner to edit this artifact.',
    cardStyle: 'Card Style',
    aspectRatio: 'Aspect Ratio',
    imageFit: 'Image Fit',
    saveImage: 'Save Image',
    print: 'Print',
    share: 'Share',
    fit: 'Fit',
    fill: 'Fill',
    minimal: 'Minimal',
    full: 'Full',
    retro: 'Retro',
    minimalTag: 'Clean & Airy',
    fullTag: 'Immersive',
    retroTag: 'Vintage',
    archivalRecord: 'Archival Record',
    artifactsCataloged: '{n} artifacts cataloged',
    itemCount: '{n} item',
    itemsCount: '{n} items',
    yes: 'Yes',
    no: 'No',
    // New features
    batchMode: 'Rapid-Fire Mode',
    batchModeDesc: 'Process multiple items in a single session.',
    vaultLock: 'Vault Lock',
    lockCollection: 'Biometric Lock Collection',
    onThisDay: 'On This Day',
    historyTitle: 'Archive Archeology',
    // Added viewHistory key to resolve App.tsx type error
    viewHistory: 'Relive Memory',
    themeSelection: 'App Aesthetic',
    themeGallery: 'The Gallery (Airy)',
    themeVault: 'The Vault (Moody)',
    themeAtelier: 'The Atelier (Organic)',
    insightPairing: 'Curator Insight',
    statusSaved: 'Saved to your archive',
    statusSynced: 'Synced',
    statusSyncPaused: 'Sync paused',
    statusImportComplete: 'Imported from local storage',
    statusImportFailed: 'Import failed',
    // Auth & Cloud
    login: 'Sign In',
    register: 'Create Account',
    close: 'Close',
    email: 'Email Address',
    password: 'Password',
    loginTitle: 'Welcome Back',
    registerTitle: 'Join the Museum',
    noAccount: "Don't have an account? Sign up",
    hasAccount: 'Already have an account? Sign in',
    signOut: 'Sign Out',
    signedInAs: 'Signed in as',
    authStatus: 'Account Status',
    authStatusSignedOut: 'Signed Out',
    authStatusSignedIn: 'Signed In',
    authDescSignedOut: 'Sign in to access your collection.',
    authDescSignedIn: 'Cloud sync active for {email}.',
    authRequiredTitle: 'Sign in to continue',
    authRequiredDesc: 'Curio now requires an account to access your collection.',
    authRequiredAction: 'Sign In',
    authLoading: 'Checking session...',
    authLoadingDesc: 'Verifying your account status.',
    cloudRequiredTitle: 'Cloud setup required',
    cloudRequiredStatus: 'Cloud Required',
    cloudRequiredDesc:
      'Supabase is required to use Curio. Configure VITE_SUPABASE_URL and VITE_SUPABASE_PUBLISHABLE_DEFAULT_KEY.',
    cloudRequiredAction: 'Configure Supabase',
    cloudSyncActive: 'Cloud Sync',
    cloudSyncTitle: 'Cloud Account',
    cloudSyncDesc: 'Your collection syncs securely across devices.',
    importLocalTitle: 'Local data found',
    importLocalDesc: 'Import your existing local collection into your account.',
    importLocalAction: 'Import Local Data',
    importing: 'Importing...',
    importComplete: 'Import complete.',
    importFailed: 'Import failed. Please try again.',
    readOnlyCollectionNote: 'Public samples are read-only. Sign in to duplicate or edit.',
    readOnlyControls: 'Edits disabled in read-only mode.',
    // Field Labels
    label_brand: 'Brand',
    label_category: 'Category',
    label_date: 'Date Acquired',
    label_location: 'Location',
    label_artist: 'Artist',
    label_label: 'Label',
    label_year: 'Year',
    label_genre: 'Genre',
    label_condition: 'Condition',
    label_house: 'House',
    label_concentration: 'Concentration',
    label_main_accords: 'Main Accords',
    label_nose: 'Nose',
    label_model: 'Model',
    label_colorway: 'Colorway',
    label_size: 'Size',
    label_style_code: 'Style Code',
    label_cocoa_percent: 'Cocoa %',
    label_origin: 'Origin',
    label_flavor_notes: 'Flavor Notes',
    label_type: 'Type',
    label_batch: 'Batch',
    label_speed: 'Speed',
    label_notes_top: 'Top Notes',
    label_notes_heart: 'Heart Notes',
    label_notes_base: 'Base Notes',
    label_season: 'Season',
    label_deadstock: 'Deadstock',
    label_age: 'Age',
    label_abv: 'ABV %',
    label_region: 'Region',
  },
  zh: {
    appTitle: '珍藏',
    appSubtitle: '博物馆',
    heroTitle: '珍藏博物馆',
    heroSubtitle: '让每一件物理记忆，都成为永恒的馆藏。',
    featuredArtifact: '馆藏珍品',
    artifacts: '珍品',
    archives: '档案馆',
    avgQuality: '平均品质',
    searchPlaceholder: '在浩瀚的档案中搜索...',
    newArchive: '新建档案馆',
    expandSpace: '扩展策展空间',
    exploreSample: '浏览示例',
    navHome: '首页',
    ctaAddFirst: '添加第一件藏品',
    ctaPromise: '不到 5 分钟完成引导式登记，AI 慢时也会保留进度。',
    catalogFirst: '开始首次编目',
    enterExhibition: '进入展厅',
    vocalGuide: '语音向导',
    galleryAwaits: '展厅虚位以待。',
    museumDefinition: '博物馆的价值，在于它所守护的一切。今天就开始你的馆藏之旅。',
    restoringArchives: '正在恢复档案库...',
    addItem: '添加珍品',
    profile: '个人中心',
    add: '添加',
    exhibitNo: '展品 第 {n} 件 / 共 {total} 件',
    updatePhoto: '更新珍品照片',
    exportCard: '导出档案卡',
    archiveNarrative: '馆藏叙述',
    technicalSpec: '技术规格',
    provenancePlaceholder: '记录这件珍品的流传与故事...',
    registryQuality: '登记品质评分',
    deleteConfirm: '确定要从馆藏中永久移除这件珍品吗？',
    analyzingPhoto: '正在分析照片...',
    geminiExtracting: 'Gemini 正在为您提取馆藏细节。',
    stepProgress: '步骤 {current}/{total}',
    stepChooseCollection: '选择馆藏',
    stepChooseCollectionDesc: '决定珍品归属的档案馆。',
    stepCapture: '添加照片',
    stepCaptureDesc: '上传或拍摄物品图片。',
    stepAnalyze: 'AI 辅助',
    stepAnalyzeDesc: '自动提取细节。',
    stepVerify: '校对信息',
    stepVerifyDesc: '检查并补充字段。',
    takePhoto: '拍摄照片',
    uploadPhoto: '上传照片',
    changePhoto: '更换照片',
    skipManual: '跳过并手动添加',
    enterManually: '手动填写',
    aiUnavailableManual: 'AI 分析不可用，请手动填写。',
    analysisFallback: '分析失败，改为手动填写。',
    addToCollection: '加入馆藏',
    rating: '评分',
    title: '标题',
    notes: '备注',
    anyRating: '不限评分',
    filterCollection: '筛选馆藏',
    clear: '清除',
    clearFilter: '移除筛选',
    clearAll: '全部清除',
    activeFilters: '已启用筛选',
    apply: '应用',
    cancel: '取消',
    createCollection: '创建收藏',
    dataPresets: '数据预设',
    presetDesc: '决定了哪些字段（如：艺术家、年份）可用。',
    templatePreview: '模板预览',
    templateFields: '包含字段',
    icon: '图标',
    name: '名称',
    guideTitle: '馆藏向导',
    guideConnecting: '正在请教档案专家...',
    guideActive: '您可以向导向询问关于您馆藏的任何故事。',
    guideError: '出错了。请检查您的麦克风设置。',
    tryAgain: '重试',
    noPhoto: '暂无照片',
    loadError: '加载失败',
    readOnlyMode: '只读模式',
    readOnlyCollectionDesc: '公开示例只能查看，无法编辑。',
    readOnlyItemDesc: '以管理员或拥有者身份登录后可编辑此珍品。',
    cardStyle: '卡片风格',
    aspectRatio: '纵横比',
    imageFit: '图片填充',
    saveImage: '保存图片',
    print: '打印',
    share: '分享',
    fit: '适应',
    fill: '填满',
    minimal: '极简',
    full: '沉浸',
    retro: '复古',
    minimalTag: '纯净空灵',
    fullTag: '身临其境',
    retroTag: '怀旧经典',
    archivalRecord: '馆藏档案记录',
    artifactsCataloged: '已编目 {n} 件珍品',
    itemCount: '{n} 件珍品',
    itemsCount: '{n} 件珍品',
    yes: '是',
    no: '否',
    // New Features ZH
    batchMode: '连拍录入模式',
    batchModeDesc: '在一次会话中处理多件珍品。',
    vaultLock: '保险库锁定',
    lockCollection: '生物识别锁定馆藏',
    onThisDay: '档案考古',
    historyTitle: '历史上的今天',
    // Added viewHistory key to resolve App.tsx type error
    viewHistory: '重温记忆',
    themeSelection: '应用美学主题',
    themeGallery: '画廊（通透白）',
    themeVault: '保险库（深邃黑）',
    themeAtelier: '工作室（原木色）',
    insightPairing: '策展人见解',
    statusSaved: '已保存到档案',
    statusSynced: '已同步',
    statusSyncPaused: '同步暂停',
    statusImportComplete: '本地数据已导入',
    statusImportFailed: '导入失败，请重试。',
    // Auth & Cloud
    login: '登录',
    register: '创建账号',
    close: '关闭',
    email: '电子邮箱',
    password: '密码',
    loginTitle: '欢迎回来',
    registerTitle: '加入博物馆',
    noAccount: '还没有账号？立即注册',
    hasAccount: '已有账号？去登录',
    signOut: '退出登录',
    signedInAs: '当前登录：',
    authStatus: '账号状态',
    authStatusSignedOut: '未登录',
    authStatusSignedIn: '已登录',
    authDescSignedOut: '登录后即可访问您的收藏。',
    authDescSignedIn: '云端同步已开启，账号：{email}。',
    authRequiredTitle: '请登录以继续',
    authRequiredDesc: 'Curio 现在需要账号才能访问您的收藏。',
    authRequiredAction: '登录',
    authLoading: '正在检查登录状态...',
    authLoadingDesc: '正在确认您的账号状态。',
    cloudRequiredTitle: '需要云端配置',
    cloudRequiredStatus: '云端未配置',
    cloudRequiredDesc:
      '使用 Curio 需要 Supabase，请配置 VITE_SUPABASE_URL 与 VITE_SUPABASE_PUBLISHABLE_DEFAULT_KEY。',
    cloudRequiredAction: '请配置 Supabase',
    cloudSyncActive: '云同步',
    cloudSyncTitle: '云端账号',
    cloudSyncDesc: '您的收藏将安全同步到所有设备。',
    importLocalTitle: '发现本地数据',
    importLocalDesc: '将本地收藏导入到您的账号中。',
    importLocalAction: '导入本地数据',
    importing: '正在导入...',
    importComplete: '导入完成。',
    importFailed: '导入失败，请重试。',
    readOnlyCollectionNote: '公开示例为只读，登录或复制后可编辑。',
    readOnlyControls: '只读模式下不可编辑。',
    // Field Labels
    label_brand: '品牌',
    label_category: '类别',
    label_date: '获得日期',
    label_location: '地点',
    label_artist: '艺术家',
    label_label: '发行商',
    label_year: '年份',
    label_genre: '流派',
    label_condition: '品相',
    label_house: '香水屋',
    label_concentration: '浓度',
    label_main_accords: '主要基调',
    label_nose: '调香师',
    label_model: '型号',
    label_colorway: '配色',
    label_size: '尺码',
    label_style_code: '款式代码',
    label_cocoa_percent: '可可含量 %',
    label_origin: '产地',
    label_flavor_notes: '风味笔记',
    label_type: '类型',
    label_batch: '批次',
    label_speed: '转速',
    label_notes_top: '前调',
    label_notes_heart: '中调',
    label_notes_base: '后调',
    label_season: '季节',
    label_deadstock: '全新未使用',
    label_age: '年份/年份',
    label_abv: '酒精度 %',
    label_region: '产区',
  },
};

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: keyof (typeof translations)['en'], params?: Record<string, any>) => string;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('en');

  const t = (key: keyof (typeof translations)['en'], params?: Record<string, any>) => {
    let text = (translations[language] as any)[key] || (translations['en'] as any)[key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(`{${k}}`, String(v));
      });
    }
    return text;
  };

  return React.createElement(
    LanguageContext.Provider,
    { value: { language, setLanguage, t } },
    children,
  );
};

export const useTranslation = () => {
  const context = useContext(LanguageContext);
  if (!context) throw new Error('useTranslation must be used within LanguageProvider');
  return context;
};
